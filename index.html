<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TV Baleia</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/video.js/8.3.0/video-js.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; }
        header { background: black; color: white; text-align: center; padding: 10px; font-size: 24px; width: 100%; }
        .player-container { text-align: center; margin-top: 20px; }
        .channel-section { width: 100%; text-align: center; margin-top: 20px; }
        .channel-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; padding: 10px; }
        .channel { display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .channel img { width: 80px; height: 80px; border: 2px solid transparent; border-radius: 10px; transition: border-color 0.3s; }
        .channel img:hover { border-color: orange; }
        .channel-name { margin-top: 5px; font-size: 14px; color: black; }
        .separator { background: orange; height: 10px; margin: 20px 0; width: 100%; }
        #map { height: 400px; width: 100%; }
        .content-below-map { padding: 20px; text-align: center; }
    </style>
</head>
<body>
    <header>TV Baleia</header>
    <div class="player-container">
        <video id="videoPlayer" class="video-js vjs-default-skin" width="640" height="360" controls muted autoplay>
            <source id="videoSource" src="" type="application/x-mpegURL">
        </video>
    </div>
    <div class="channel-section">
        <h3>Selecione um Canal</h3>
        <div class="channel-container" id="channelContainer"></div>
    </div>
    <div class="separator"></div>
    <div id="map"></div>
    <div class="content-below-map">
        <p>Este é um conteúdo adicional abaixo do mapa.</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/video.js/8.3.0/video.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let player;
        
        async function loadPlaylist() {
            const response = await fetch("https://raw.githubusercontent.com/otaviobelo/lista99/refs/heads/main/pacote-02.m3u");
            const text = await response.text();
            
            const channels = [];
            const lines = text.split("\n");
            
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].startsWith("#EXTINF")) {
                    const nameMatch = lines[i].match(/tvg-name="(.*?)"/);
                    const logoMatch = lines[i].match(/tvg-logo="(.*?)"/);
                    const latMatch = lines[i].match(/tvg-latitude="(.*?)"/);
                    const lonMatch = lines[i].match(/tvg-longitude="(.*?)"/);
                    const streamUrl = lines[i + 1]?.trim();
                    
                    if (nameMatch && logoMatch && latMatch && lonMatch && streamUrl) {
                        channels.push({
                            name: nameMatch[1],
                            logo: logoMatch[1],
                            lat: parseFloat(latMatch[1]),
                            lon: parseFloat(lonMatch[1]),
                            streamUrl: streamUrl
                        });
                    }
                }
            }
            
            if (channels.length > 0) {
                initializePlayer(channels[0].streamUrl);
                loadChannels(channels);
            }
            
            initMap(channels);
        }
        
        function initializePlayer(url) {
            player = videojs("videoPlayer", {
                autoplay: true,
                muted: true,
                controls: true,
                sources: [{ src: url, type: "application/x-mpegURL" }]
            });
        }
        
        function changeStream(url) {
            if (player) {
                player.src({ src: url, type: "application/x-mpegURL" });
                player.play();
            }
        }
        
        function loadChannels(channels) {
            const channelContainer = document.getElementById("channelContainer");
            channelContainer.innerHTML = "";
            channels.forEach(channel => {
                if (channel.logo) {
                    const channelDiv = document.createElement("div");
                    channelDiv.classList.add("channel");
                    channelDiv.addEventListener("click", () => changeStream(channel.streamUrl));
                    
                    const img = document.createElement("img");
                    img.src = channel.logo;
                    img.alt = channel.name;
                    img.title = channel.name;
                    
                    const name = document.createElement("div");
                    name.classList.add("channel-name");
                    name.textContent = channel.name;
                    
                    channelDiv.appendChild(img);
                    channelDiv.appendChild(name);
                    channelContainer.appendChild(channelDiv);
                }
            });
        }
        
        function initMap(channels) {
            const map = L.map("map").setView([-15, -55], 4);
            L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);
            
            channels.forEach(channel => {
                const marker = L.marker([channel.lat, channel.lon]).addTo(map);
                
                if (channel.logo) {
                    const logo = `<img src="${channel.logo}" width="100" height="100">`;
                    marker.bindTooltip(logo, { permanent: false, direction: "top" });
                }
                
                marker.on("click", () => {
                    changeStream(channel.streamUrl);
                });
            });
        }
        
        loadPlaylist();
    </script>
</body>
</html>
